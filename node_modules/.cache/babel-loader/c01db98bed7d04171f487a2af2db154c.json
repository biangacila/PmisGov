{"ast":null,"code":"import _regeneratorRuntime from \"/home/biangacila/reactprojects/easi-fleet-web/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/biangacila/reactprojects/easi-fleet-web/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this2 = this;\n\nimport React from 'react';\nimport moment from 'moment';\nimport eConfig from '../config';\nvar serverHTTP = eConfig.serverBackend;\nvar serverWS = eConfig.serverWS;\nvar TOKEN_KEY = \"token\";\nvar TOKEN_USER = \"@fleet-user\";\n\nvar ConvertDateFormatFromStdToSA = function ConvertDateFormatFromStdToSA(dateIn) {\n  var mydate = moment(dateIn, \"YYYY-MM-DD\").format(\"DD MMM YYYY\");\n  return mydate;\n};\n\nvar SaveToken = function SaveToken(token, user) {\n  localStorage.setItem(TOKEN_KEY, token);\n  localStorage.setItem(TOKEN_USER, JSON.stringify(user));\n};\n\nvar CheckLogin =\n/*#__PURE__*/\nfunction () {\n  var _ref = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(props, callback) {\n    var token, hub, endpoint;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _retrieveData(\"token\");\n\n          case 2:\n            token = _context.sent;\n            console.log(\"CheckLogin > \", token);\n\n            if (!(token === null)) {\n              _context.next = 7;\n              break;\n            }\n\n            callback(false, -100, \"Authentication failed, Please login\");\n            return _context.abrupt(\"return\");\n\n          case 7:\n            if (!(token === undefined)) {\n              _context.next = 10;\n              break;\n            }\n\n            callback(false, -100, \"Authentication failed, Please login\", {});\n            return _context.abrupt(\"return\");\n\n          case 10:\n            if (!(token === \"undefined\")) {\n              _context.next = 13;\n              break;\n            }\n\n            callback(false, -100, \"Authentication failed, Please login\", {});\n            return _context.abrupt(\"return\");\n\n          case 13:\n            hub = {\n              token: token\n            };\n            endpoint = \"/user/token-info\";\n            _context.next = 17;\n            return PostRequestHTTP(hub, endpoint, function (data, err) {\n              if (err !== null) {\n                callback(false, -200, \"Server unavailable, Please try again late\", {});\n                return;\n              }\n\n              var rs = data.DATA;\n\n              if (rs.boo) {\n                //todo do nothing\n                console.log(\"Response code is 200\");\n                callback(true, 200, \"OK\", rs.user);\n                return;\n              }\n\n              console.log(\"CheckLogin feedback err > \", err, \" > \", rs.boo); //removeFromStorage(\"token\")\n\n              callback(false, -100, \"Authentication failed, Please login\", {});\n            });\n\n          case 17:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, this);\n  }));\n\n  return function CheckLogin(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar PostRequestHTTP =\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(hub, endpoint, callback) {\n    var url;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            url = serverHTTP + endpoint; //console.log(\"PostRequestHTTP: \",url,\" > \",hub);\n\n            _context2.next = 3;\n            return fetch(url, {\n              method: \"POST\",\n              headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n              },\n              body: JSON.stringify(hub)\n            }).then(function (response) {\n              return response.json();\n            }).then(function (response) {\n              //console.log(\"2 PostRequestHTTP: \",url,\" > \",response);\n              var status = response.status;\n              callback(response, null, status);\n            }).catch(function (e) {\n              callback(null, e, null);\n            });\n\n          case 3:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, this);\n  }));\n\n  return function PostRequestHTTP(_x3, _x4, _x5) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nvar PostRequestWS =\n/*#__PURE__*/\nfunction () {\n  var _ref3 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee3(hub, endpoint, callback) {\n    var url;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            url = serverWS + endpoint;\n            fetch(url, {\n              method: \"POST\",\n              headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n              },\n              body: JSON.stringify(hub)\n            }).then(function (response) {\n              return response.json();\n            }).then(function (response) {\n              var status = response.status;\n              callback(response, null, status);\n            }).catch(function (e) {\n              callback(null, e, null);\n            });\n\n          case 2:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, this);\n  }));\n\n  return function PostRequestWS(_x6, _x7, _x8) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nvar _redirectComponent = function _redirectComponent(_this, name, msg) {\n  var tmp = _this.state;\n  tmp.currContainer = name;\n\n  _this.setState(tmp);\n\n  if (msg !== \"\") {\n    alert(msg);\n  }\n};\n\nvar _retrieveData =\n/*#__PURE__*/\nfunction () {\n  var _ref4 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee4(key) {\n    var myKey, value;\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            myKey = '@TRANSY:' + key;\n            _context4.prev = 1;\n            _context4.next = 4;\n            return localStorage.getItem(myKey);\n\n          case 4:\n            value = _context4.sent;\n\n            if (!(value !== null)) {\n              _context4.next = 7;\n              break;\n            }\n\n            return _context4.abrupt(\"return\", value);\n\n          case 7:\n            _context4.next = 12;\n            break;\n\n          case 9:\n            _context4.prev = 9;\n            _context4.t0 = _context4[\"catch\"](1);\n            return _context4.abrupt(\"return\", \"\");\n\n          case 12:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4, this, [[1, 9]]);\n  }));\n\n  return function _retrieveData(_x9) {\n    return _ref4.apply(this, arguments);\n  };\n}();\n\nvar SaveToStorage =\n/*#__PURE__*/\nfunction () {\n  var _ref5 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee5(key, val) {\n    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.prev = 0;\n            _context5.next = 3;\n            return localStorage.setItem('@TRANSY:' + key, val);\n\n          case 3:\n            _context5.next = 8;\n            break;\n\n          case 5:\n            _context5.prev = 5;\n            _context5.t0 = _context5[\"catch\"](0);\n            // Error saving data\n            console.log(\"_storeData > \", key, val);\n\n          case 8:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5, this, [[0, 5]]);\n  }));\n\n  return function SaveToStorage(_x10, _x11) {\n    return _ref5.apply(this, arguments);\n  };\n}();\n\nvar _removeData =\n/*#__PURE__*/\nfunction () {\n  var _ref6 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee6(key) {\n    return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            _context6.prev = 0;\n            _context6.next = 3;\n            return localStorage.removeItem('@TRANSY:' + key);\n\n          case 3:\n            _context6.next = 8;\n            break;\n\n          case 5:\n            _context6.prev = 5;\n            _context6.t0 = _context6[\"catch\"](0);\n            // Error saving data\n            console.log(\"_removeData error > \", key);\n\n          case 8:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6, this, [[0, 5]]);\n  }));\n\n  return function _removeData(_x12) {\n    return _ref6.apply(this, arguments);\n  };\n}();\n\nvar getLoginUser =\n/*#__PURE__*/\nfunction () {\n  var _ref7 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee7(_this) {\n    var u, user, tmp;\n    return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n      while (1) {\n        switch (_context7.prev = _context7.next) {\n          case 0:\n            _context7.next = 2;\n            return _retrieveData(\"user\");\n\n          case 2:\n            u = _context7.sent;\n            console.log(\"---> getLoginUser user > \", u);\n\n            if (!(u === undefined)) {\n              _context7.next = 7;\n              break;\n            }\n\n            _this.setState({\n              User: null,\n              company: \"\",\n              email: user.Email,\n              role: user.Role\n            });\n\n            return _context7.abrupt(\"return\");\n\n          case 7:\n            user = JSON.parse(u);\n            tmp = _this2.state;\n            tmp.User = user;\n            tmp.company = user.Company;\n            tmp.email = user.Email;\n            tmp.role = user.Role;\n\n            _this.setState({\n              User: user,\n              company: user.Company,\n              email: user.Email,\n              role: user.Role\n            });\n\n            console.log(\"---> LoginUser > \", _this.state.User.Email, \" > \", tmp.role);\n\n          case 15:\n          case \"end\":\n            return _context7.stop();\n        }\n      }\n    }, _callee7, this);\n  }));\n\n  return function getLoginUser(_x13) {\n    return _ref7.apply(this, arguments);\n  };\n}();\n\nexport { CheckLogin, PostRequestHTTP, PostRequestWS, _redirectComponent, _retrieveData, SaveToStorage, _removeData, getLoginUser, ConvertDateFormatFromStdToSA };","map":{"version":3,"sources":["/home/biangacila/reactprojects/easi-fleet-web/src/api/services.js"],"names":["React","moment","eConfig","serverHTTP","serverBackend","serverWS","TOKEN_KEY","TOKEN_USER","ConvertDateFormatFromStdToSA","dateIn","mydate","format","SaveToken","token","user","localStorage","setItem","JSON","stringify","CheckLogin","props","callback","_retrieveData","console","log","undefined","hub","endpoint","PostRequestHTTP","data","err","rs","DATA","boo","url","fetch","method","headers","body","then","response","json","status","catch","e","PostRequestWS","_redirectComponent","_this","name","msg","tmp","state","currContainer","setState","alert","key","myKey","getItem","value","SaveToStorage","val","_removeData","removeItem","getLoginUser","u","User","company","email","Email","role","Role","parse","Company"],"mappings":"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","sourcesContent":["import React from 'react';\nimport moment from 'moment';\nimport eConfig from '../config';\n\n\nconst serverHTTP = eConfig.serverBackend;\nconst serverWS = eConfig.serverWS;\nconst TOKEN_KEY=\"token\";\nconst TOKEN_USER =\"@fleet-user\";\n\n\nconst ConvertDateFormatFromStdToSA=(dateIn) =>{\n    let mydate = moment(dateIn, \"YYYY-MM-DD\").format(\"DD MMM YYYY\");\n    return mydate;\n};\n\n\nlet SaveToken=(token,user)=>{\n    localStorage.setItem(TOKEN_KEY,token);\n    localStorage.setItem(TOKEN_USER,JSON.stringify(user))\n}\nlet CheckLogin =async (props,callback) => {\n\n    let token = await _retrieveData(\"token\");\n    console.log(\"CheckLogin > \", token);\n\n    if (token === null) {\n        callback(false, -100, \"Authentication failed, Please login\");\n        return;\n    }\n    if (token === undefined) {\n        callback(false, -100, \"Authentication failed, Please login\",{});\n        return;\n    }\n    if (token === \"undefined\") {\n        callback(false, -100, \"Authentication failed, Please login\",{});\n        return;\n    }\n\n    const hub = {token: token};\n    const endpoint = \"/user/token-info\";\n\n    await PostRequestHTTP(hub, endpoint, function (data, err) {\n\n        if (err !== null) {\n            callback(false, -200, \"Server unavailable, Please try again late\",{});\n            return;\n        }\n        const rs = data.DATA;\n        if (rs.boo) {\n            //todo do nothing\n            console.log(\"Response code is 200\");\n            callback(true, 200, \"OK\",rs.user);\n            return\n        }\n        console.log(\"CheckLogin feedback err > \",err,\" > \" ,rs.boo);\n        //removeFromStorage(\"token\")\n        callback(false, -100, \"Authentication failed, Please login\",{});\n\n    });\n}\n\nlet PostRequestHTTP = async (hub, endpoint, callback) => {\n    let url = serverHTTP + endpoint;\n    //console.log(\"PostRequestHTTP: \",url,\" > \",hub);\n   await fetch(url, {\n        method: \"POST\",\n        headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(hub)\n    })\n        .then((response) => response.json())\n        .then((response) => {\n            //console.log(\"2 PostRequestHTTP: \",url,\" > \",response);\n            const status = response.status;\n            callback(response, null, status);\n        }).catch((e) => {\n        callback(null, e, null);\n    });\n}\nlet PostRequestWS = async (hub, endpoint, callback) => {\n    let url = serverWS + endpoint;\n    fetch(url, {\n        method: \"POST\",\n        headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(hub)\n    })\n        .then((response) => response.json())\n        .then((response) => {\n            const status = response.status;\n            callback(response, null, status);\n        }).catch((e) => {\n        callback(null, e, null);\n    });\n}\n\n\nlet _redirectComponent = (_this, name, msg) => {\n    let tmp = _this.state;\n    tmp.currContainer = name;\n    _this.setState(tmp);\n    if (msg !== \"\") {\n        alert(msg)\n    }\n}\n\n\nlet _retrieveData = async (key) => {\n    const myKey = '@TRANSY:' + key;\n    try {\n        const value = await  localStorage.getItem(myKey);\n        if (value !== null) {\n            return value;\n        }\n    } catch (error) {\n\n        // Error retrieving data\n        return \"\"\n    }\n}\n\nlet SaveToStorage = async (key, val) => {\n    try {\n        await localStorage.setItem('@TRANSY:' + key, val);\n    } catch (error) {\n        // Error saving data\n        console.log(\"_storeData > \", key, val);\n    }\n}\n\nlet _removeData = async (key) => {\n    try {\n        await localStorage.removeItem('@TRANSY:' + key);\n    } catch (error) {\n        // Error saving data\n        console.log(\"_removeData error > \", key);\n    }\n}\n\nlet  getLoginUser = async(_this)=> {\n    const u = await _retrieveData(\"user\");\n    console.log(\"---> getLoginUser user > \", u );\n    if(u ===undefined){\n        _this.setState({\n            User:null,\n            company:\"\",\n            email:  user.Email,\n            role:user.Role,\n        });\n        return\n    }\n    const user = JSON.parse(u);\n\n    let tmp = this.state;\n    tmp.User = user;\n    tmp.company = user.Company;\n    tmp.email = user.Email;\n    tmp.role = user.Role;\n    _this.setState({\n        User:user,\n        company:user.Company,\n        email:  user.Email,\n        role:user.Role,\n    });\n\n    console.log(\"---> LoginUser > \", _this.state.User.Email,\" > \", tmp.role );\n}\n\n\nexport {CheckLogin, PostRequestHTTP,PostRequestWS, _redirectComponent, _retrieveData, SaveToStorage, _removeData,getLoginUser,ConvertDateFormatFromStdToSA};\n\n"]},"metadata":{},"sourceType":"module"}